<!DOCTYPE html>
<html lang="en">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="">
  <meta name="author" content="">

  <title>Voluntas</title>

  <!-- Bootstrap Core CSS -->
  <link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

  <!-- Custom Fonts -->
  <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">
  <link href="vendor/simple-line-icons/css/simple-line-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.css" rel="stylesheet">

  <!-- Custom CSS -->
  <link href="css/stylish-portfolio.min.css" rel="stylesheet">

</head>

<body id="page-top">

  <!-- Navigation -->
  <a class="menu-toggle rounded" href="#">
    <i class="fas fa-bars"></i>
  </a>
  <nav id="sidebar-wrapper">
    <ul class="sidebar-nav">
      <li class="sidebar-brand">
        <a class="js-scroll-trigger" href="#page-top">Voluntas project</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="#page-top">Home</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="#about" data-bind="text: projectMenuDemo"></a>
      </li>
      <!-- <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="#services">Services</a>
      </li>
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="#portfolio">Portfolio</a>
      </li> -->
      <li class="sidebar-nav-item">
        <a class="js-scroll-trigger" href="#contact">Contact</a>
      </li>
    </ul>
  </nav>

  <!-- Header -->
  <header class="masthead d-flex">
    <div class="container text-center my-auto">
      <h1 class="mb-1" data-bind="text: projectName"></h1>
      <h3 class="mb-5">
        <em data-bind="text: projectSlogan"></em>
      </h3>
      <a class="btn btn-primary btn-xl js-scroll-trigger" href="#about">Find Out More</a>
    </div>
    <div class="overlay"></div>
  </header>

  <!-- About -->
  <section class="content-section bg-light" id="about">
    <div class="container text-center">
      <div class="row">
        <div class="col-lg-10 mx-auto">
          <h2 data-bind="text: projectMenuDemo"></h2>

          <div id="buttonShow" data-bind="visible: buttonInitialSetup">
            <button type="button" class="btn btn-info"  data-bind="click: initDemo">Show initial setup</button>
          </div>

          <div id="infoAccounts" data-bind="visible: contentInitialSetup">
            <h3>Accounts:</h3>

            <!-- <div class="alert alert-info alert-dismissible fade show" id="balances">
              <button type="button" class="close" data-dismiss="alert">&times;</button>
              <strong>Light!</strong> Light grey alert.
            </div> -->

            <ul class="list-group">
              <li class="list-group-item active">Issuer account</li>
              <li class="list-group-item">
                <a data-bind="text: issuerPublic, attr: { href: 'https://horizon-testnet.stellar.org/accounts/'+issuerPublic()}" target="_blank"></a> 
              </li>
              <li class="list-group-item" data-bind="text: issuerPrivate"></li>
            </ul>
            <ul class="list-group">
              <li class="list-group-item active">Receiver account</li>
              <li class="list-group-item">
                <a data-bind="text: receiverPublic, attr: { href: 'https://horizon-testnet.stellar.org/accounts/'+receiverPublic()}" target="_blank"></a>
                <div id="accountReceiver"></div>
                <i class="fas fa-rocket" data-bind="click: getBalance('Receiver',receiverPublic())"></i>
              </li>
              <li class="list-group-item" data-bind="text: receiverPrivate"></li>
            </ul>

            <ul class="list-group" data-bind="foreach: accounts">
                 <li class="list-group-item active" data-bind="text: $index"></li>
                 <li class="list-group-item">
                  <a data-bind="text: public, attr: { href: 'https://horizon-testnet.stellar.org/accounts/'+public}" target="_blank"></a>
                  <div data-bind="attr: {id:'account'+$index()}"></div>
                  <i class="fas fa-rocket" data-bind="click: $parent.getBalance($index(),public)"></i>
                </li>
                 <li class="list-group-item" data-bind="text: private"></li>
                 <li class="list-group-item" data-bind="text: alias"></li>
            </ul>
          </div>

          <div>
            <p class="lead mb-5"><button type="button" class="btn btn-info"  data-bind="click: configureReceiver,visible: btnConfigureReceiver">Configure receiver</button></p>  
            <div id="result_configure_receiver"></div>
          </div>


          <div>
            <p class="lead mb-5"><button type="button" class="btn btn-info"  data-bind="click: sendTokens,visible: btnSendTokens">Send tokens</button></p>
            <div id="result_send_tokens"></div>
          </div>
          <!-- <p class="lead mb-5"><button type="button" class="btn btn-info"  data-bind="click: initDemo">Show initial setup</button></p> -->
          <a class="btn btn-dark btn-xl js-scroll-trigger" href="#services" data-bind="click: startVoting">Vote</a>
        </div>
      </div>
    </div>
  </section>

  <!-- Services -->
  <section class="content-section bg-primary text-white text-center" id="services">
    <div class="container">
      <div class="content-section-heading">
        <h3 class="text-secondary mb-0">Consulta popular para:</h3>
        <h2 class="mb-5">Quiere que la linea 3, sea construida?</h2>
      </div>
    </div>
    <div class="container text-center">
      <ul class="list-group" data-bind="foreach: accounts">
           <li class="list-group-item active" data-bind="text: $index"></li>

           <li class="list-group-item" style="background-color: #c0c0c0;">
             <div class="form-check">
                <input class="form-check-input" type="radio" name="exampleRadios" value="Si" checked data-bind="attr: { id: 'exampleRadiosA'+$index()}">
                <label class="form-check-label" data-bind="attr: { for: 'exampleRadiosA'+$index()}">
                 Si
                </label>
              </div>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="exampleRadios" value="No" checked data-bind="attr: { id: 'exampleRadiosB'+$index()}">
                <label class="form-check-label" data-bind="attr: { for: 'exampleRadiosB'+$index()}">
                 No
                </label>
              </div>
           </li>

           <li class="list-group-item">
             <button type="button" class="btn btn-info"  data-bind="click: $parent.vote($index()), attr: { id: 'buttonVote'+$index()}">Votar</button>
           </li>
      </ul>
      <a class="btn btn-dark btn-xl js-scroll-trigger" href="#resultsPoll" data-bind="click: seeResults">See results</a>
    </div>
  </section>

  <!-- Callout -->
  <section class="callout" id="resultsPoll">
   <!--  <div class="container text-center">
      <h2 class="mx-auto mb-5">Welcome to
        <em>your</em>
        next website!</h2>
      <a class="btn btn-primary btn-xl" href="https://startbootstrap.com/template-overviews/stylish-portfolio/">Download Now!</a>
    </div> -->
    <div class="container text-center">
      <h2 class="mx-auto mb-5">Results:</h2>
    </div>
    <div class="container text-center" style="background-color: white;width: 400px;height: 400px">
     <canvas id="myChart" width="200" height="200"></canvas> 
    </div>
  </section>

  <!-- Portfolio -->
  <!-- <section class="content-section" id="portfolio">
    <div class="container">
      <div class="content-section-heading text-center">
        <h3 class="text-secondary mb-0">Portfolio</h3>
        <h2 class="mb-5">Recent Projects</h2>
      </div>
      <div class="row no-gutters">
        <div class="col-lg-6">
          <a class="portfolio-item" href="#">
            <span class="caption">
              <span class="caption-content">
                <h2>Stationary</h2>
                <p class="mb-0">A yellow pencil with envelopes on a clean, blue backdrop!</p>
              </span>
            </span>
            <img class="img-fluid" src="img/portfolio-1.jpg" alt="">
          </a>
        </div>
        <div class="col-lg-6">
          <a class="portfolio-item" href="#">
            <span class="caption">
              <span class="caption-content">
                <h2>Ice Cream</h2>
                <p class="mb-0">A dark blue background with a colored pencil, a clip, and a tiny ice cream cone!</p>
              </span>
            </span>
            <img class="img-fluid" src="img/portfolio-2.jpg" alt="">
          </a>
        </div>
        <div class="col-lg-6">
          <a class="portfolio-item" href="#">
            <span class="caption">
              <span class="caption-content">
                <h2>Strawberries</h2>
                <p class="mb-0">Strawberries are such a tasty snack, especially with a little sugar on top!</p>
              </span>
            </span>
            <img class="img-fluid" src="img/portfolio-3.jpg" alt="">
          </a>
        </div>
        <div class="col-lg-6">
          <a class="portfolio-item" href="#">
            <span class="caption">
              <span class="caption-content">
                <h2>Workspace</h2>
                <p class="mb-0">A yellow workspace with some scissors, pencils, and other objects.</p>
              </span>
            </span>
            <img class="img-fluid" src="img/portfolio-4.jpg" alt="">
          </a>
        </div>
      </div>
    </div>
  </section> -->

  <!-- Call to Action -->
  <!-- <section class="content-section bg-primary text-white">
    <div class="container text-center">
      <h2 class="mb-4">The buttons below are impossible to resist...</h2>
      <a href="#" class="btn btn-xl btn-light mr-4">Click Me!</a>
      <a href="#" class="btn btn-xl btn-dark">Look at Me!</a>
    </div>
  </section> -->

  <!-- Map -->
  <section id="contact" class="map">
   <!--  <iframe width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?f=q&amp;source=s_q&amp;hl=en&amp;geocode=&amp;q=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;aq=0&amp;oq=twitter&amp;sll=28.659344,-81.187888&amp;sspn=0.128789,0.264187&amp;ie=UTF8&amp;hq=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;t=m&amp;z=15&amp;iwloc=A&amp;output=embed"></iframe> -->
   <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d12833.486044957244!2d-103.45796269496465!3d20.73028604284399!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x8428a9bfb86b8b15%3A0xe48a76aaeeac9c51!2sTecnol%C3%B3gico%20de%20Monterrey!5e0!3m2!1sen!2smx!4v1588052465981!5m2!1sen!2smx" width="100%" height="100%" frameborder="0" scrolling="no" marginheight="0" marginwidth="0"></iframe>
    <br />
    <small>
      <a href="https://maps.google.com/maps?f=q&amp;source=embed&amp;hl=en&amp;geocode=&amp;q=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;aq=0&amp;oq=twitter&amp;sll=28.659344,-81.187888&amp;sspn=0.128789,0.264187&amp;ie=UTF8&amp;hq=Twitter,+Inc.,+Market+Street,+San+Francisco,+CA&amp;t=m&amp;z=15&amp;iwloc=A"></a>
    </small>
  </section>

  <!-- Footer -->
  <footer class="footer text-center">
    <div class="container">
      <ul class="list-inline mb-5">
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#">
            <i class="icon-social-facebook"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white mr-3" href="#">
            <i class="icon-social-twitter"></i>
          </a>
        </li>
        <li class="list-inline-item">
          <a class="social-link rounded-circle text-white" href="#">
            <i class="icon-social-github"></i>
          </a>
        </li>
      </ul>
      <p class="text-muted small mb-0">Copyright &copy; Voluntas 2020</p>
    </div>
  </footer>

  <!-- Scroll to Top Button-->
  <a class="scroll-to-top rounded js-scroll-trigger" href="#page-top">
    <i class="fas fa-angle-up"></i>
  </a>

  <!-- Bootstrap core JavaScript -->
  <script src="vendor/jquery/jquery.min.js"></script>
  <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>

  <!-- Plugin JavaScript -->
  <script src="vendor/jquery-easing/jquery.easing.min.js"></script>

  <!-- Custom scripts for this template -->
  <script src="js/stylish-portfolio.min.js"></script>

  <!-- Charts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>

  <!-- Knockout js -->
  <script type='text/javascript' src='js/knockout-3.5.1.js'></script>
  <script type="text/javascript">
    // This is a simple *viewmodel* - JavaScript that defines the data and behavior of your UI
    function AppViewModel() {
        // UI values
        this.projectName = "Voluntas";
        this.projectSlogan = "A new way to redefine democracy";

        this.projectMenuDemo = "Demo";

        //Important values
        this.issuerPublic = ko.observable("");
        this.issuerPrivate = ko.observable("");
        this.receiverPublic = ko.observable("");
        this.receiverPrivate = ko.observable("");
        this.accounts = ko.observableArray();

        //Poll results
        this.resultsA = ko.observable(0);
        this.resultsB = ko.observable(0);

        //vissible attribues
        this.buttonInitialSetup = ko.observable(true);
        this.contentInitialSetup = ko.observable(false);
        this.btnConfigureReceiver = ko.observable(false);
        this.btnSendTokens = ko.observable(false);

        this.isPollEnabled = ko.observable(false);


        this.initDemo = function(){ //http://www.localhost:3000/playground
          $.get( "get-all-accounts", function( data ) {
            console.log( data );
            this.issuerPublic(data.issuer.public);
            this.issuerPrivate(data.issuer.private);

            this.receiverPublic(data.receiver.public);
            this.receiverPrivate(data.receiver.private);

            this.accounts(data.accounts);

            this.buttonInitialSetup(false);
            this.contentInitialSetup(true);
            this.btnConfigureReceiver(true);
          }.bind(this));
        }//End init Function

        this.getBalance = function(index,publicKey){

          $.get( "balances/"+publicKey, function( data ) {

            var div = "<div class='alert alert-info alert-dismissible fade show' id='balances'>";
                div += " <button type='button' class='close' data-dismiss='alert'>&times;</button>";
                div += "<table class='table table-hover'>";
                div += " <thead><tr>";
                div += "<th>Type</th>";
                div += "<th>Asset code</th>";
                div += "<th>Balance</th>";
                div += "</tr></thead>";
                div += "<tbody>";
                for(var i in data) {
                  div += "<tr>";
                    div += "<td>"+data[i].type+"</td>";
                    div += "<td>"+data[i].asset_code+"</td>";
                    div += "<td>"+data[i].balance+"</td>";
                  div += "</tr>";
                }
               div += "</tbody></table></div>";
            $("#account"+index).html(div);
          }.bind(this));
        }// End getBalance

        this.configureReceiver = function(){
          $.get( "configure-receiver", function( data ) {
            var div = "<div class='alert alert-success alert-dismissible'>";
                  div += "<button type='button' class='close' data-dismiss='alert'>&times;</button>";
                  div += "<strong>Success!</strong>";
                  div += data;
                div += "</div>";
            $("#result_configure_receiver").html(div);
            this.btnConfigureReceiver(false);
            this.btnSendTokens(true);
          }.bind(this));
        }//End configureReceiver

        this.sendTokens = function(){
           $.get( "tokens", function( data ) {
            var div = "<div class='alert alert-success alert-dismissible'>";
                  div += "<button type='button' class='close' data-dismiss='alert'>&times;</button>";
                  div += "<strong>Success!</strong>";
                  div += data;
                div += "</div>";
            $("#result_send_tokens").html(div);
            this.btnSendTokens(false);
          }.bind(this));
        }//End sendTokens

        this.startVoting = function(){
          this.isPollEnabled(true);
        }

        this.seeResults = function(){
           $.get( "balances/"+this.receiverPublic(), function( data ) {
               for(var i in data) {
                 if(data[i].asset_code === "MXNA"){
                    this.resultsA(  Math.round(data[i].balance) );
                 }else if(data[i].asset_code === "MXNB"){
                    this.resultsB( Math.round(data[i].balance) );
                 }
               }
               this.drawChart();
          }.bind(this));
          
        }//End seeResults

        this.vote = function(index){
          if(!this.isPollEnabled()){
            return;
          }
          console.log(index);
          var idElementA = '#exampleRadiosA'+index;
          var idElementB = '#exampleRadiosB'+index;
          var idButton = '#buttonVote'+index;

          var option = "";

          if( $(idElementA).is(':checked') ){
              option = "MXNA";
          }else if( $(idElementB).is(':checked')  ){
              option = "MXNB";
          }

          // console.log( $(idElementA).is(':checked') );
          // console.log( $(idElementB).is(':checked') );

          $.get( "vote/"+index+"/"+option, function( data ) {
               console.log("Voted:"+option);
               if(data == "already-voted"){
                alert("Ya has votado, no es posible votar mas de 1 vez");
               }
          }.bind(this));

          $( idElementA ).prop( "disabled",true);
          $( idElementB ).prop( "disabled",true);
          $( idButton ).prop( "disabled",true);
        }//End vote

        //Start chart
        this.drawChart = function(){
          var ctx = document.getElementById('myChart').getContext('2d');
          var myChart = new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: ['Si', 'No'],
                  datasets: [{
                      label: '# of Votes',
                      data: [ this.resultsA(), this.resultsB() ], //this.resultsA()
                      backgroundColor: [
                          'rgba(255, 99, 132, 0.2)',
                          'rgba(54, 162, 235, 0.2)'
                      ],
                      borderColor: [
                          'rgba(255, 99, 132, 1)',
                          'rgba(54, 162, 235, 1)'
                      ],
                      borderWidth: 1
                  }]
              },
              options: {
                  scales: {
                      yAxes: [{
                          ticks: {
                              beginAtZero: true
                          }
                      }]
                  }
              }
          });
        }
        //End chart


    }// End appViewModel

    $(document).ready(function () {
      // Activates knockout.js
      ko.applyBindings( new AppViewModel() );
    });
    
  </script>
</body>

</html>

<!-- Explore txn in Stellar Laboratory
https://laboratory.stellar.org/#explorer?resource=transactions&endpoint=for_account&values=eyJhY2NvdW50X2lkIjoiR0JXNFVGWDdCNUJZU1BQRzNRVzVMTkZXUkhXRExOWURTQktGNkdTWEVZRlRaNVZQVFhSTjVRQlAifQ%3D%3D&network=test -->
